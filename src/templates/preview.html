{% extends "base.html" %}

{% block content %}
<header class="preview-header">
    <div>
        <h1>–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–π</h1>
        <p>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–æ–±—Ä–∞–Ω–Ω—ã–µ –ø–∞—Ä—ã –∏ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –∏—Ö –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º —Å—Ä–∞–≤–Ω–µ–Ω–∏—è.</p>
    </div>
    <a href="/" class="btn btn-outline">–ó–∞–≥—Ä—É–∑–∏—Ç—å –¥—Ä—É–≥–∏–µ —Ñ–∞–π–ª—ã</a>
</header>

<form action="{% if mode == 'puml-puml' %}/upload-puml-puml{% else %}/upload{% endif %}" method="post"
    class="preview-form">
    <input type="hidden" name="session_id" value="{{ session_id }}">
    <section class="preview-summary" aria-label="–ö—Ä–∞—Ç–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏">
        <article class="summary-card">
            <strong>{{ summary.puml_count }}</strong>
            <span>{% if mode == 'puml-puml' %}–ü–µ—Ä–≤—ã—Ö PUML{% else %}PUML{% endif %} —Ñ–∞–π–ª–æ–≤</span>
        </article>
        <article class="summary-card">
            <strong>{{ summary.json_count }}</strong>
            <span>{% if mode == 'puml-puml' %}–í—Ç–æ—Ä—ã—Ö PUML{% else %}JSON{% endif %} —Ñ–∞–π–ª–æ–≤</span>
        </article>
        <article class="summary-card">
            <strong>{{ summary.paired_count }}</strong>
            <span>–°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</span>
        </article>
        <article class="summary-card">
            <strong>{{ summary.pending_count }}</strong>
            <span>–¢—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è</span>
        </article>
    </section>

    {% if unmatched_json %}
    <div class="unmatched-list" role="note">
        <strong>{% if mode == 'puml-puml' %}–í—Ç–æ—Ä—ã–µ PUML{% else %}JSON{% endif %} –±–µ–∑ –ø–∞—Ä—ã:</strong>
        <p>–≠—Ç–∏ —Ñ–∞–π–ª—ã –ø–æ–∫–∞ –Ω–∏ —Å —á–µ–º –Ω–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω—ã –∏ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ –≤—ã–ø–∞–¥–∞—é—â–µ–º —Å–ø–∏—Å–∫–µ.</p>
        <ul>
            {% for json in unmatched_json %}
            <li>{{ json.label }}</li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}

    <div class="pairing-table-wrapper">
        <table class="pairing-table">
            <thead>
                <tr>
                    <th scope="col">{% if mode == 'puml-puml' %}–ü–µ—Ä–≤—ã–π{% else %}–≠—Ç–∞–ª–æ–Ω{% endif %} (PUML)</th>
                    <th scope="col">{% if mode == 'puml-puml' %}–í—Ç–æ—Ä–æ–π (PUML){% else %}–†–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–π JSON{% endif %}</th>
                    <th scope="col">–°—Ç–∞—Ç—É—Å</th>
                </tr>
            </thead>
            <tbody>
                {% for pair in pairings %}
                <tr data-pairing-row>
                    <td>
                        <div class="pairing-file">{{ pair.puml.label }}</div>
                        <input type="hidden" name="puml_files" value="{{ pair.puml.filename }}">
                    </td>
                    <td>
                        <div class="pairing-control">
                            <span class="pairing-selection" data-selection-label>
                                {{ pair.json.label if pair.json else '–ù–µ –≤—ã–±—Ä–∞–Ω' }}
                            </span>
                            <button type="button" class="icon-button" data-edit-pairing
                                aria-label="–ò–∑–º–µ–Ω–∏—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ">
                                ‚úèÔ∏è
                            </button>
                            <select name="json_choices" class="pairing-dropdown" data-pairing-select>
                                <option value="">–ù–µ —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å</option>
                                {% for option in json_options %}
                                <option value="{{ option.filename }}" {% if pair.json and
                                    option.filename==pair.json.filename %}selected{% endif %}>
                                    {{ option.label }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                    </td>
                    <td>
                        <span class="status-badge status-{{ 'auto' if pair.json else 'warning' }}">
                            {{ '–ê–≤—Ç–æ–≤—ã–±–æ—Ä' if pair.json else '–ù—É–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å' }}
                        </span>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="preview-actions">
        <a href="/" class="btn btn-outline">–ù–∞–∑–∞–¥</a>
        <button type="submit" class="btn btn-primary">
            <span class="btn-icon">üöÄ</span>
            –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ
        </button>
    </div>
</form>
{% endblock %}